pipeline {
    agent any

    stages {
        stage('build') {
            steps {

            }
        }
        stage('test') {
            steps {

            }
        }
        stage('deploy') {
            steps {
                echo 'running deployment'
                // update this pipeline to deploy the EC2 resource using Terraform.
                // the files are provided in terraform folder.
                sh('terraform init')
                sh('terraform plan')
                sh('terraform apply -auto-approve')
                // extract the instance_id of the newly created EC2.
                def instanceID = sh(returnStdout: true, script: 'terraform output instance_id').trim()

                // execute remotely on the EC2, the script at the path '/root/ami/init.sh' (assume this script already exists on the ami).

                // ** user_data
                // ** terraform remote exec
                // ** send-command to run the script.
                
            }
        }
    }
}
